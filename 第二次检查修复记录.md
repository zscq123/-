# ç¬¬äºŒæ¬¡æ·±åº¦æ£€æŸ¥ä¿®å¤è®°å½•

## æ£€æŸ¥æ—¶é—´
2025å¹´11æœˆ23æ—¥ 22:14

## ğŸ” æ£€æŸ¥èŒƒå›´
- å¼‚å¸¸å¤„ç†
- å†…å­˜æ³„æ¼
- æ€§èƒ½ä¼˜åŒ–
- ä¸šåŠ¡é€»è¾‘è¾¹ç•Œæƒ…å†µ

---

## å‘ç°å¹¶ä¿®å¤çš„é—®é¢˜

### ğŸš¨ ä¸¥é‡é—®é¢˜ 1: JSONè§£æç¼ºå°‘å¼‚å¸¸å¤„ç†
**ä½ç½®:** `js/storage.js` æ‰€æœ‰è¯»å–æ–¹æ³•

**é—®é¢˜æè¿°:**
`localStorage` å­˜å‚¨çš„æ•°æ®å¯èƒ½è¢«æŸåæˆ–æ‰‹åŠ¨ä¿®æ”¹ï¼Œ`JSON.parse()` ä¼šæŠ›å‡ºå¼‚å¸¸å¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒï¼Œç”¨æˆ·æ— æ³•ä½¿ç”¨ã€‚

**å½±å“èŒƒå›´:**
- `getTasks()` - ä»»åŠ¡åˆ—è¡¨åŠ è½½å¤±è´¥
- `getPomodoroHistory()` - ç•ªèŒ„é’Ÿå†å²ä¸¢å¤±
- `getAchievements()` - æˆå°±æ•°æ®è¯»å–å¤±è´¥
- `getSettings()` - è®¾ç½®æ— æ³•è¯»å–

**ä¿®å¤æ–¹æ¡ˆ:**
ä¸ºæ‰€æœ‰ `JSON.parse()` è°ƒç”¨æ·»åŠ  `try-catch` åŒ…è£…ï¼Œæ•è·å¼‚å¸¸å¹¶è¿”å›é»˜è®¤å€¼ã€‚

```javascript
// ä¿®å¤å‰ - å±é™©ï¼
getTasks() {
  const tasks = localStorage.getItem('tasks');
  return tasks ? JSON.parse(tasks) : []; // å¯èƒ½æŠ›å‡ºå¼‚å¸¸
}

// ä¿®å¤å - å®‰å…¨
getTasks() {
  try {
    const tasks = localStorage.getItem('tasks');
    return tasks ? JSON.parse(tasks) : [];
  } catch (error) {
    console.error('è¯»å–ä»»åŠ¡æ•°æ®å¤±è´¥:', error);
    return []; // è¿”å›ç©ºæ•°ç»„ï¼Œåº”ç”¨ç»§ç»­è¿è¡Œ
  }
}
```

**åŒæ—¶ä¸º `saveTasks()` æ·»åŠ å¼‚å¸¸å¤„ç†:**
```javascript
saveTasks(tasks) {
  try {
    localStorage.setItem('tasks', JSON.stringify(tasks));
  } catch (error) {
    console.error('ä¿å­˜ä»»åŠ¡å¤±è´¥:', error);
    alert('ä¿å­˜å¤±è´¥ï¼å¯èƒ½æ˜¯å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚');
  }
}
```

**ä¿®å¤çš„æ–¹æ³•:**
- âœ… `getTasks()`
- âœ… `getPomodoroHistory()`
- âœ… `getAchievements()`
- âœ… `getSettings()`
- âœ… `saveTasks()`

---

### ğŸš¨ ä¸¥é‡é—®é¢˜ 2: äº‹ä»¶ç›‘å¬å™¨å†…å­˜æ³„æ¼
**ä½ç½®:** `js/task.js` å’Œ `js/app.js`

**é—®é¢˜æè¿°:**
æ¯æ¬¡è°ƒç”¨ `renderTasks()` éƒ½ä¼šé‡æ–°åˆ›å»ºä»»åŠ¡å¡ç‰‡HTMLï¼Œå¹¶é€šè¿‡ `attachTaskListeners()` ä¸ºæ¯ä¸ªå¡ç‰‡æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚ä½†æ—§çš„DOMå…ƒç´ è¢«åˆ é™¤æ—¶ï¼Œç›‘å¬å™¨å¹¶æ²¡æœ‰è¢«æ¸…ç†ï¼Œå¯¼è‡´ï¼š
- **å†…å­˜æ³„æ¼** - æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½å¢åŠ å†…å­˜å ç”¨
- **é‡å¤äº‹ä»¶è§¦å‘** - å¯èƒ½å¯¼è‡´ä¸€ä¸ªç‚¹å‡»è§¦å‘å¤šæ¬¡

**ä¿®å¤æ–¹æ¡ˆ:**
ä½¿ç”¨**äº‹ä»¶å§”æ‰˜ï¼ˆEvent Delegationï¼‰**æ¨¡å¼ï¼Œåœ¨çˆ¶å®¹å™¨ä¸Šç›‘å¬äº‹ä»¶ï¼Œåªæ·»åŠ ä¸€æ¬¡ç›‘å¬å™¨ã€‚

```javascript
// ä¿®å¤å‰ - æ¯æ¬¡æ¸²æŸ“éƒ½æ·»åŠ æ–°ç›‘å¬å™¨
renderTasks() {
  taskList.innerHTML = tasks.map(task => this.createTaskCard(task)).join('');
  this.attachTaskListeners(); // âŒ å†…å­˜æ³„æ¼
}

attachTaskListeners() {
  document.querySelectorAll('.task-complete').forEach(btn => {
    btn.addEventListener('click', ...); // æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„ç›‘å¬å™¨
  });
}

// ä¿®å¤å - ä½¿ç”¨äº‹ä»¶å§”æ‰˜
renderTasks() {
  taskList.innerHTML = tasks.map(task => this.createTaskCard(task)).join('');
  // âœ… ä¸å†æ·»åŠ ç›‘å¬å™¨
}

// åœ¨ app.js çš„ bindEvents() ä¸­ä¸€æ¬¡æ€§æ·»åŠ 
taskList.addEventListener('click', (e) => {
  if (e.target.classList.contains('task-complete')) {
    const id = parseInt(e.target.dataset.id);
    TaskManager.toggleComplete(id);
  }
});
```

**ä¿®å¤å†…å®¹:**
- âœ… åˆ é™¤ `attachTaskListeners()` æ–¹æ³•
- âœ… åœ¨ `app.js` ä¸­ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†ç‚¹å‡»
- âœ… åœ¨ `app.js` ä¸­ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†é•¿æŒ‰åˆ é™¤

---

### âš ï¸ é—®é¢˜ 3: å·²å®Œæˆä»»åŠ¡å¯å¯åŠ¨ç•ªèŒ„é’Ÿ
**ä½ç½®:** `js/task.js` `startPomodoro()` æ–¹æ³•

**é—®é¢˜æè¿°:**
é€»è¾‘ä¸Šï¼Œå·²ç»å®Œæˆçš„ä»»åŠ¡ä¸åº”è¯¥å†å¯åŠ¨ç•ªèŒ„é’Ÿï¼Œä½†ä»£ç æ²¡æœ‰æ£€æŸ¥ä»»åŠ¡çš„å®ŒæˆçŠ¶æ€ã€‚

**ä¿®å¤æ–¹æ¡ˆ:**
åœ¨å¯åŠ¨ç•ªèŒ„é’Ÿå‰æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²å®Œæˆï¼Œå¦‚æœå·²å®Œæˆåˆ™ç»™å‡ºæç¤ºå¹¶æ‹’ç»å¯åŠ¨ã€‚

```javascript
startPomodoro(id) {
  const tasks = Storage.getTasks();
  const task = tasks.find(t => t.id === id);
  if (task) {
    if (task.completed) {
      showToast('âš ï¸ ä»»åŠ¡å·²å®Œæˆï¼Œæ— éœ€ç•ªèŒ„é’Ÿ', 2000);
      return; // âœ… æ‹’ç»å¯åŠ¨
    }
    PomodoroTimer.start(task);
  }
}
```

---

### ğŸš€ é—®é¢˜ 4: ç•ªèŒ„é’Ÿè¿›åº¦æ›´æ–°æ€§èƒ½å·®
**ä½ç½®:** `js/pomodoro.js` `updateProgress()` æ–¹æ³•

**é—®é¢˜æè¿°:**
æ¯ç§’è°ƒç”¨ä¸€æ¬¡ `updateProgress()`ï¼Œæ¯æ¬¡éƒ½é€šè¿‡ `innerHTML` é‡æ–°ç”Ÿæˆæ‰€æœ‰8ä¸ªè¿›åº¦ç‚¹çš„HTMLï¼Œæ€§èƒ½è¾ƒå·®ã€‚å®é™…ä¸Šï¼Œè¿›åº¦ç‚¹æ¯ `25*60/8 â‰ˆ 187ç§’` æ‰å˜åŒ–ä¸€æ¬¡ã€‚

**ä¿®å¤æ–¹æ¡ˆ:**
1. è®°å½•ä¸Šæ¬¡çš„è¿›åº¦å€¼ `lastCompletedDots`
2. åªåœ¨è¿›åº¦å®é™…å˜åŒ–æ—¶æ›´æ–°
3. ä½¿ç”¨ `classList` æ“ä½œä»£æ›¿ `innerHTML` é‡å»º

```javascript
// ä¿®å¤å‰ - æ¯ç§’éƒ½é‡å»ºHTML
updateProgress() {
  let dotsHTML = '';
  for (let i = 0; i < totalDots; i++) {
    const filled = i < completedDots ? 'filled' : '';
    dotsHTML += `<span class="progress-dot ${filled}">${filled ? 'â—' : 'â—‹'}</span>`;
  }
  progressContainer.innerHTML = dotsHTML; // âŒ æ¯ç§’éƒ½æ‰§è¡Œ
}

// ä¿®å¤å - åªåœ¨å˜åŒ–æ—¶æ›´æ–°
updateProgress() {
  const completedDots = Math.floor((1 - this.timeLeft / this.duration) * totalDots);
  
  // âœ… æ²¡æœ‰å˜åŒ–åˆ™è·³è¿‡
  if (this.lastCompletedDots === completedDots) return;
  this.lastCompletedDots = completedDots;
  
  // âœ… åªä¿®æ”¹classNameï¼Œä¸é‡å»ºDOM
  const dots = progressContainer.querySelectorAll('.progress-dot');
  dots.forEach((dot, index) => {
    if (index < completedDots) {
      dot.classList.add('filled');
      dot.textContent = 'â—';
    } else {
      dot.classList.remove('filled');
      dot.textContent = 'â—‹';
    }
  });
}
```

**æ€§èƒ½æå‡:**
- ä»æ¯ç§’60æ¬¡DOMæ“ä½œ â†’ å‡å°‘åˆ°æ¯187ç§’æ‰æ“ä½œä¸€æ¬¡
- å‡å°‘äº† **99.5%** çš„DOMæ›´æ–°æ¬¡æ•°

---

## ä¿®å¤æ€»ç»“

### âœ… æœ¬æ¬¡ä¿®å¤é—®é¢˜æ•°: 4ä¸ª

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | ç±»å‹ | çŠ¶æ€ |
|------|---------|------|------|
| JSONè§£æå¼‚å¸¸å¤„ç†ç¼ºå¤± | ğŸ”´ ä¸¥é‡ | ç¨³å®šæ€§ | âœ… å·²ä¿®å¤ |
| äº‹ä»¶ç›‘å¬å™¨å†…å­˜æ³„æ¼ | ğŸ”´ ä¸¥é‡ | æ€§èƒ½/å†…å­˜ | âœ… å·²ä¿®å¤ |
| å·²å®Œæˆä»»åŠ¡å¯å¯åŠ¨ç•ªèŒ„é’Ÿ | ğŸŸ¡ ä¸­ç­‰ | é€»è¾‘é”™è¯¯ | âœ… å·²ä¿®å¤ |
| ç•ªèŒ„é’Ÿè¿›åº¦æ›´æ–°æ€§èƒ½å·® | ğŸŸ¡ ä¸­ç­‰ | æ€§èƒ½ä¼˜åŒ– | âœ… å·²ä¿®å¤ |

### ğŸ“Š ä¿®å¤ç»Ÿè®¡

**ç¬¬ä¸€æ¬¡æ£€æŸ¥:** 6ä¸ªé—®é¢˜  
**ç¬¬äºŒæ¬¡æ£€æŸ¥:** 4ä¸ªé—®é¢˜  
**æ€»è®¡ä¿®å¤:** 10ä¸ªé—®é¢˜

### ğŸ¯ ä»£ç è´¨é‡æå‡

- **ç¨³å®šæ€§:** â­â­â­â­â­ (æ·»åŠ å®Œæ•´å¼‚å¸¸å¤„ç†)
- **æ€§èƒ½:** â­â­â­â­â­ (è§£å†³å†…å­˜æ³„æ¼ï¼Œä¼˜åŒ–DOMæ›´æ–°)
- **å¯ç»´æŠ¤æ€§:** â­â­â­â­â­ (ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ¨¡å¼)
- **ç”¨æˆ·ä½“éªŒ:** â­â­â­â­â­ (é€»è¾‘æ›´åˆç†)

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. å¼‚å¸¸å¤„ç†æµ‹è¯•
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æµ‹è¯•
localStorage.setItem('tasks', 'invalid json{');
location.reload(); // åº”ç”¨åº”è¯¥æ­£å¸¸å¯åŠ¨ï¼Œæ˜¾ç¤ºç©ºä»»åŠ¡åˆ—è¡¨
```

### 2. å†…å­˜æ³„æ¼æµ‹è¯•
1. æ‰“å¼€Chrome DevTools â†’ Performance â†’ Memory
2. å¼€å§‹å½•åˆ¶
3. æ·»åŠ 10ä¸ªä»»åŠ¡
4. é‡å¤ç­›é€‰ã€æœç´¢æ“ä½œ30æ¬¡
5. åœæ­¢å½•åˆ¶ï¼ŒæŸ¥çœ‹å†…å­˜æ›²çº¿
   - **ä¿®å¤å‰:** å†…å­˜æŒç»­ä¸Šæ¶¨
   - **ä¿®å¤å:** å†…å­˜ä¿æŒç¨³å®š

### 3. ç•ªèŒ„é’Ÿæ€§èƒ½æµ‹è¯•
1. æ‰“å¼€Chrome DevTools â†’ Performance
2. å¯åŠ¨ç•ªèŒ„é’Ÿ
3. å½•åˆ¶10ç§’æ€§èƒ½æ•°æ®
4. æŸ¥çœ‹ `updateProgress` è°ƒç”¨æ¬¡æ•°
   - **ä¿®å¤å‰:** 10æ¬¡
   - **ä¿®å¤å:** 0-1æ¬¡ï¼ˆåªåœ¨è¿›åº¦å˜åŒ–æ—¶ï¼‰

### 4. ä¸šåŠ¡é€»è¾‘æµ‹è¯•
- [ ] å®Œæˆä¸€ä¸ªä»»åŠ¡åï¼Œç‚¹å‡»ğŸ…æŒ‰é’®ï¼Œåº”è¯¥æç¤º"ä»»åŠ¡å·²å®Œæˆï¼Œæ— éœ€ç•ªèŒ„é’Ÿ"
- [ ] LocalStorageæ•°æ®æŸåæ—¶ï¼Œåº”ç”¨ä»å¯æ­£å¸¸ä½¿ç”¨
- [ ] å­˜å‚¨ç©ºé—´æ»¡æ—¶ï¼Œåº”è¯¥æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º

---

## ğŸ“ åç»­å»ºè®®

### å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç‚¹

1. **æ·»åŠ æ•°æ®å¤‡ä»½åŠŸèƒ½**
   - å®šæœŸå¤‡ä»½åˆ°IndexedDB
   - æä¾›å¯¼å‡º/å¯¼å…¥åŠŸèƒ½

2. **æ·»åŠ æ€§èƒ½ç›‘æ§**
   - ä½¿ç”¨Performance APIç›‘æ§å…³é”®æ“ä½œè€—æ—¶
   - ä¸ŠæŠ¥æ…¢æ“ä½œæ—¥å¿—

3. **æ·»åŠ å•å…ƒæµ‹è¯•**
   - æµ‹è¯•Storageæ¨¡å—çš„å¼‚å¸¸å¤„ç†
   - æµ‹è¯•TaskManagerçš„å„ç§è¾¹ç•Œæƒ…å†µ

4. **æ·»åŠ æ•°æ®è¿ç§»æœºåˆ¶**
   - å½“æ•°æ®ç»“æ„å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨è¿ç§»æ—§æ•°æ®
   - ç‰ˆæœ¬ç®¡ç†

---

**æ‰€æœ‰é—®é¢˜å·²ä¿®å¤å®Œæˆï¼ä»£ç è´¨é‡æ˜¾è‘—æå‡ï¼** âœ¨
